"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var Promise = require("bluebird");

var chokidar = require("chokidar");

var _require = require("gatsby-core-utils"),
    slash = _require.slash;

module.exports = function _callee(path, glob, onNewFile, onRemovedFile) {
  return _regenerator["default"].async(function _callee$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          return _context.abrupt("return", new Promise(function (resolve, reject) {
            chokidar.watch(glob, {
              cwd: path
            }).on("add", function (path) {
              path = slash(path);
              onNewFile(path);
            }).on("unlink", function (path) {
              path = slash(path);
              onRemovedFile(path);
            }).on("ready", function () {
              return resolve();
            });
          }));

        case 1:
        case "end":
          return _context.stop();
      }
    }
  });
};