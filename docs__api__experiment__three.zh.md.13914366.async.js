"use strict";(self.webpackChunk_antv_l7_site=self.webpackChunk_antv_l7_site||[]).push([[4817],{96069:function(e,a,n){n.r(a);n(35164),n(43801),n(6974),n(27068),n(33574);var t=n(7808),r=(n(19480),n(97595),n(22593),n(99500)),l=n(13273),s=n(92379),d=n(25802),i=n(651);a.default=function(){return(0,i.jsx)(r.dY,{children:(0,i.jsx)(s.Suspense,{fallback:(0,i.jsx)(l.Z,{}),children:(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"markdown",children:[(0,i.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n h3 { color: #873bf4; border-bottom: 1px solid #f0f0f0; margin: 1.2em 0 0.4em; } p { margin: 0.6em 0; } h4 { border-bottom: 1px solid #f0f0f0; }h4::before { content: '> '; opacity: 0.5; } "}}),(0,i.jsxs)("h2",{id:"简介",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#简介",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"简介"]}),(0,i.jsx)("p",{children:d.texts[0].value}),(0,i.jsx)("p",{children:d.texts[1].value}),(0,i.jsx)("p",{children:d.texts[2].value}),(0,i.jsx)("p",{children:d.texts[3].value}),(0,i.jsx)("p",{children:d.texts[4].value}),(0,i.jsxs)("h2",{id:"使用",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#使用",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"使用"]}),(0,i.jsx)(t.Z,{lang:"javascript",children:d.texts[5].value}),(0,i.jsx)("p",{children:d.texts[6].value}),(0,i.jsxs)("h2",{id:"构造函数-new-threelayer",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#构造函数-new-threelayer",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"构造函数 new ThreeLayer"]}),(0,i.jsxs)("h3",{id:"onaddmeshes",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#onaddmeshes",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"onAddMeshes"]}),(0,i.jsx)("p",{children:d.texts[7].value}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:d.texts[8].value}),(0,i.jsx)("li",{children:d.texts[9].value})]}),(0,i.jsxs)("h2",{id:"threelayer",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#threelayer",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"ThreeLayer"]}),(0,i.jsx)("p",{children:d.texts[10].value}),(0,i.jsx)("p",{children:d.texts[11].value}),(0,i.jsxs)("h3",{id:"getmodelmatrixlnglat-altitude-rotation-scale-matrix",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#getmodelmatrixlnglat-altitude-rotation-scale-matrix",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"getModelMatrix(lnglat, altitude, rotation, scale): Matrix"]}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:d.texts[12].value}),(0,i.jsx)("li",{children:d.texts[13].value}),(0,i.jsx)("li",{children:d.texts[14].value}),(0,i.jsx)("li",{children:d.texts[15].value})]}),(0,i.jsx)("p",{children:d.texts[16].value}),(0,i.jsxs)("h3",{id:"applyobjectlnglatobject-lnglat-altibute-void",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#applyobjectlnglatobject-lnglat-altibute-void",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"applyObjectLngLat(object, lnglat, altibute): void"]}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:d.texts[17].value}),(0,i.jsx)("li",{children:d.texts[18].value}),(0,i.jsx)("li",{children:d.texts[19].value})]}),(0,i.jsx)("p",{children:d.texts[20].value}),(0,i.jsxs)("h3",{id:"setobjectlnglatobject-lnglat-altibute-void",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#setobjectlnglatobject-lnglat-altibute-void",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"setObjectLngLat(object, lnglat, altibute): void"]}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:d.texts[21].value}),(0,i.jsx)("li",{children:d.texts[22].value}),(0,i.jsx)("li",{children:d.texts[23].value})]}),(0,i.jsx)("p",{children:d.texts[24].value}),(0,i.jsxs)("h3",{id:"lnglattocoordlnglat-number-number",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#lnglattocoordlnglat-number-number",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"lnglatToCoord(lnglat): [number, number]"]}),(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:d.texts[25].value})}),(0,i.jsx)("p",{children:d.texts[26].value}),(0,i.jsxs)("h3",{id:"adjustmeshtomapobject-void",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#adjustmeshtomapobject-void",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"adjustMeshToMap(object): void"]}),(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:d.texts[27].value})}),(0,i.jsx)("p",{children:d.texts[28].value}),(0,i.jsx)("p",{children:d.texts[29].value}),(0,i.jsx)("p",{children:d.texts[30].value}),(0,i.jsxs)("h3",{id:"setmeshscaleobject-x-y-z-void",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#setmeshscaleobject-x-y-z-void",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"setMeshScale(object, x, y, z): void"]}),(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:d.texts[31].value}),(0,i.jsx)("li",{children:d.texts[32].value}),(0,i.jsx)("li",{children:d.texts[33].value}),(0,i.jsx)("li",{children:d.texts[34].value})]}),(0,i.jsx)("p",{children:d.texts[35].value}),(0,i.jsx)("p",{children:d.texts[36].value}),(0,i.jsx)("p",{children:d.texts[37].value}),(0,i.jsxs)("h3",{id:"addanimatemixermixer-void",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#addanimatemixermixer-void",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"addAnimateMixer(mixer): void"]}),(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:d.texts[38].value})}),(0,i.jsx)("p",{children:d.texts[39].value}),(0,i.jsxs)("h3",{id:"getrendercamera-threecamera",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#getrendercamera-threecamera",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"getRenderCamera(): THREE.Camera"]}),(0,i.jsx)("p",{children:d.texts[40].value}),(0,i.jsxs)("h2",{id:"加载模型",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#加载模型",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"加载模型"]}),(0,i.jsx)("p",{children:d.texts[41].value}),(0,i.jsxs)("h3",{id:"简单案例",children:[(0,i.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#简单案例",children:(0,i.jsx)("span",{className:"icon icon-link"})}),"简单案例"]}),(0,i.jsx)("p",{children:d.texts[42].value}),(0,i.jsx)(t.Z,{lang:"javascript",children:d.texts[43].value})]})})})})}},23832:function(e,a,n){n.d(a,{T:function(){return t.T}});var t=n(87575)},90779:function(e,a,n){n.d(a,{p:function(){return t.p}});var t=n(25441)},41102:function(e,a,n){n.d(a,{G:function(){return t.G}});var t=n(4481)},3088:function(e,a,n){n.d(a,{S:function(){return t.S}});var t=n(74284)},25802:function(e,a,n){n.r(a),n.d(a,{texts:function(){return t}});const t=[{value:"1、L7 支持允许用户接入第三方的渲染引擎对地图场景进行开发，threejs 作为当前最广泛使用的通用 3D 渲染引擎，L7 将其集成后可以满足\n用户自定义开发的需求，可以让 L7 覆盖更多的应用场景。",paraId:0,tocIndex:0},{value:"2、目前 L7Three 模块为了抹平不同地图底图之间的差异，提供了一些兼容方法，如 setMeshScale 方法，通过这些方法用户可以在不同的底图\n环境中使用同一套代码。",paraId:1,tocIndex:0},{value:"3、L7 提供的适配方法只负责 threejs 世界坐标到不同地图底图坐标的转化、 gl 上下文的共享以及渲染帧的同步，其余关于 3D 场景内容的搭建\n与普通 threejs 应用的开发没有任何区别。",paraId:2,tocIndex:0},{value:"4、L7 本身并没有集成 threejs，所以用于在使用 L7Three 模块的时候需要独立安装 threejs。",paraId:3,tocIndex:0},{value:"✨ 目前 L7 官方提供的 threejs 兼容是根据 0.115.0 版本进行开发的，使用其他版本 threejs 可能会存在兼容问题",paraId:4,tocIndex:0},{value:"// 1、引入对应模块\nimport { ThreeLayer, ThreeRender } from '@antv/l7-three';\nimport * as THREE from 'three';\n...\n// 2、注册服务\nscene.registerRenderService(ThreeRender);\n...\n// 3、构建 threejs 图层对象并在其中添加 threejs 构建的网格对象\nconst threeJSLayer = new ThreeLayer({\n  onAddMeshes: (threeScene: THREE.Scene, layer: ThreeLayer) => {\n    threeScene.add(new THREE.AmbientLight(0xffffff));\n\n    const sunlight = new THREE.DirectionalLight(0xffffff, 0.25);\n    sunlight.position.set(0, 80000000, 100000000);\n    sunlight.matrixWorldNeedsUpdate = true;\n    threeScene.add(sunlight);\n\n    let center = scene.getCenter();\n\n    let cubeGeometry = new THREE.BoxBufferGeometry(10000, 10000, 10000);\n    let cubeMaterial = new THREE.MeshNormalMaterial();\n    let cube = new THREE.Mesh(cubeGeometry, cubeMaterial);\n\n    layer.setObjectLngLat(cube, [center.lng + 0.05, center.lat], 0);\n    threeScene.add(cube);\n  },\n})\n.source(data)\n.animate(true);\n\n// 4、添加 threejs 图层对象\nscene.addLayer(threeJSLayer);\n\n",paraId:5,tocIndex:1},{value:"L7 将 threejs 的引用封装成一个特殊的图层对象，在使用上与其他的图层相同。",paraId:6,tocIndex:1},{value:"该方法接受两个参数 threeScene: THREE.Scene, layer: ThreeLayer",paraId:7,tocIndex:3},{value:"threeScene: 这是普通的 threejs 场景对象",paraId:8,tocIndex:3},{value:"layer: 这是 L7 提供的 threeLayer 对象，上面挂载了 threejs 空间适配到地图空间所需要的方法",paraId:8,tocIndex:3},{value:"用户新建的图层对象，同时也会在 onAddMesh 方法的第二个参数返回。",paraId:9,tocIndex:4},{value:"以下是挂载在 ThreeLayer 实例上的适配方法。",paraId:10,tocIndex:4},{value:"lnglat: [number, number] 经纬度",paraId:11,tocIndex:5},{value:"altitude: number = 0 相对高度",paraId:11,tocIndex:5},{value:"rotation: [number, number, number] = [0, 0, 0] 旋转角度",paraId:11,tocIndex:5},{value:"scale: [number, number, number] = [1, 1, 1] 缩放比例",paraId:11,tocIndex:5},{value:"用户可以通过该方法计算在对应经纬度点位、相对高度、旋转角度和缩放的模型矩阵\n该方法的返回值是 THREE.Matrix4 类型的矩阵",paraId:12,tocIndex:5},{value:"object: Object3D threejs 对象",paraId:13,tocIndex:6},{value:"lnglat: ILngLat[number, number] 经纬度",paraId:13,tocIndex:6},{value:"altitude = 0 相对高度",paraId:13,tocIndex:6},{value:"用户可以通过该方法将 object 对象从当前位置向指定位置移动（地图经纬度坐标）",paraId:14,tocIndex:6},{value:"object: Object3D threejs 对象",paraId:15,tocIndex:7},{value:"lnglat: ILngLat[number, number] 经纬度",paraId:15,tocIndex:7},{value:"altitude = 0 相对高度",paraId:15,tocIndex:7},{value:"用户可以通过该方法设置 object 对象的位置（地图经纬度坐标）",paraId:16,tocIndex:7},{value:"lnglat: ILngLat[number, number] 经纬度",paraId:17,tocIndex:8},{value:"用户可以通过该方法将经纬度坐标转化成 threejs 世界坐标",paraId:18,tocIndex:8},{value:"object: Object3D threejs 对象",paraId:19,tocIndex:9},{value:"用户在添加 threejs 对象的前可以通过该方法调整 3D 对象的姿态，保证添加对象能正确显示",paraId:20,tocIndex:9},{value:"✨ 在 threejs 世界坐标中，默认的上方向为 Y 轴正方向，而在地图坐标中，默认的上方向为 Z 轴正方向",paraId:21,tocIndex:9},{value:"✨ 用户不一定使用该方法调整物体的姿态，也可以自己实现",paraId:22,tocIndex:9},{value:"object: Object3D threejs 对象",paraId:23,tocIndex:10},{value:"x: number = 1 x 轴方向的缩放比例",paraId:23,tocIndex:10},{value:"y: number = 1 y 轴方向的缩放比例",paraId:23,tocIndex:10},{value:"z: number = 1 z 轴方向的缩放比例",paraId:23,tocIndex:10},{value:"用户可以通过该方法设置 threejs 对象缩放",paraId:24,tocIndex:10},{value:"✨ 其实通过设置 threejs 对象的 scale 属性一样能达到同样的效果，但是由于 mapbox 在计算模型矩阵的时候引入了特殊计算，所以无法直接设置 scale 属性进行缩放",paraId:25,tocIndex:10},{value:"✨ 同样的，可以直接修改 threejs 的 position、rotation 等调整 3D 对象的姿态",paraId:26,tocIndex:10},{value:"mixer: AnimationMixer threejs 的动画混合器",paraId:27,tocIndex:11},{value:"用户通过该方法管理加载模型的动画",paraId:28,tocIndex:11},{value:"返回根据当前地图场景参数下对应的 THREEJS 相机",paraId:29,tocIndex:12},{value:"用户可以使用 threejs 提供的能力加载其支持的任意模型",paraId:30,tocIndex:13},{value:"✨ 以加载 gltf 模型为例",paraId:31,tocIndex:14},{value:"// 1、引入加载器\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\n...\nconst threeJSLayer = new ThreeLayer({\n  onAddMeshes: (threeScene: THREE.Scene, layer: ThreeLayer) => {\n    ...\n    // 2、构建加载器\n    const loader = new GLTFLoader();\n    // 3、加载模型\n    loader.load('https://gw.alipayobjects.com/os/bmw-prod/3ca0a546-92d8-4ba0-a89c-017c218d5bea.gltf',\n    (gltf) => {\n      const model = gltf.scene;\n      layer.adjustMeshToMap(model);\n      layer.setMeshScale(model, 1000, 1000, 1000);\n      layer.setObjectLngLat( model, [center.lng, center.lat], 0 );\n\n      // 4、播放模型上绑定的动画\n      const animations = gltf.animations;\n      if (animations && animations.length) {\n        const mixer = new THREE.AnimationMixer(model);\n        const animation = animations[2];\n        const action = mixer.clipAction(animation);\n        action.play();\n        // 5、由 L7 控制模型动画的播放\n        layer.addAnimateMixer(mixer);\n      }\n    })\n  }\n}).source(data)\n.animate(true) // 若需要播放模型动画，请开启动画模式（或者场景中已经存在开启动画的图层）\n\n",paraId:32,tocIndex:14}]}}]);